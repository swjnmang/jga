#!/usr/bin/env node
import fs from 'node:fs';
import path from 'node:path';

const root = process.cwd();
const flagsDir = path.join(root, 'public', 'assets', 'flags');
const outFile = path.join(root, 'lib', 'flagCards.ts');

function toDisplayName(code) {
  try {
    const dn = new Intl.DisplayNames(['de'], { type: 'region' });
    const name = dn.of(code.toUpperCase());
    if (name && name !== code.toUpperCase()) return name;
  } catch (_) {
    // ignore
  }
  return code.toUpperCase();
}

const files = fs.readdirSync(flagsDir).filter((f) => f.toLowerCase().endsWith('.png')).sort();
const seen = new Set();
const cards = [];
for (const file of files) {
  const code = file.replace(/\.png$/i, '');
  if (seen.has(code)) continue;
  seen.add(code);
  const name = toDisplayName(code);
  cards.push({
    id: `flag-${code.toLowerCase()}`,
    title: `Flagge ${name}`,
    category: 'country',
    year: 1900,
    cue: 'Zu welchem Land gehört diese Flagge und wann wurde es gegründet?',
    answer: `${name} – Staatsflagge (Jahr variabel).`,
    hint: name,
    difficulty: 'mittel',
    sources: {
      image: `/assets/flags/${file}`
    }
  });
}

const content = `// AUTO-GENERATED by scripts/generate-flag-cards.mjs\n// Do not edit manually.\nimport { Card } from './types';\n\nexport const flagCards: Card[] = ${JSON.stringify(cards, null, 2)};\n`;
fs.writeFileSync(outFile, content);
console.log(`Wrote ${cards.length} flag cards to ${path.relative(root, outFile)}`);
